<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Library Seat Map</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-3xl font-bold mb-4 text-center text-blue-800">ЁЯУЪ Library Seat Map</h1>

  <p class="text-center text-gray-700 mb-6">
    <strong class="block mb-1">ЁЯУМ When you enter the library, mark your seat. When you leave, unmark it so that others can use the seat to learn something. Thank you for your efforts!</strong>
    <span class="text-sm text-gray-600">ЁЯУМ рдЬрдм рдЖрдк рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░реЗрдВ рддреЛ рдЕрдкрдиреА рд╕реАрдЯ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░реЗрдВ рдФрд░ рдЬрдм рдмрд╛рд╣рд░ рдЬрд╛рдПрдВ рддреЛ рдЙрд╕реЗ рдЕрдирдЪреЗрдХ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдХреЛрдИ рдФрд░ рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗред рдЖрдкрдХреЗ рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рджред</span>
  </p>

  <div id="seats" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 max-w-6xl mx-auto">
    {% for seat in seats %}
      <div 
        class="p-4 rounded-lg shadow text-center cursor-pointer seat-box 
               {% if seat.status == 'available' %}bg-green-200{% else %}bg-red-300{% endif %}" 
        data-id="{{ seat.id }}" 
        data-status="{{ seat.status }}"
      >
        <p class="text-lg font-semibold">Seat {{ seat.id }}</p>
        <span class="block mt-2 font-bold 
              {% if seat.status == 'available' %}text-green-800{% else %}text-red-800{% endif %}">
          {% if seat.status == 'available' %}тЬЕ Seat Available{% else %}тЫФ Seat Not Available{% endif %}
        </span>
      </div>
    {% endfor %}
  </div>

  <!-- Reset Form -->
  <div class="text-center mt-8">
    <form method="POST" action="/reset" onsubmit="return confirmReset();">
      <input 
        type="password" 
        name="password" 
        placeholder="Enter admin password" 
        required
        class="px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring"
      />
      <button 
        type="submit" 
        class="ml-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
      >
        Reset All Seats
      </button>
    </form>
  </div>

  <script>
    document.querySelectorAll(".seat-box").forEach(box => {
      box.addEventListener("click", async () => {
        const seatId = box.dataset.id;
        const currentStatus = box.dataset.status;

        const endpoint = currentStatus === "available" ? `/checkin/${seatId}` : `/free/${seatId}`;
        const res = await fetch(endpoint, { method: "POST" });

        if (res.ok) {
          const newStatus = currentStatus === "available" ? "occupied" : "available";
          box.dataset.status = newStatus;

          box.classList.toggle("bg-green-200");
          box.classList.toggle("bg-red-300");

          const statusText = box.querySelector("span");
          statusText.innerText = newStatus === "available" ? "тЬЕ Seat Available" : "тЫФ Seat Not Available";
          statusText.classList.toggle("text-green-800");
          statusText.classList.toggle("text-red-800");
        }
      });
    });

    function confirmReset() {
      return confirm("Are you sure you want to reset all seats?");
    }
  </script>
</body>
</html>
