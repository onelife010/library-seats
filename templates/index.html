<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Library Seat Map</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-2xl font-bold mb-2 text-center">ЁЯУЪ APNI LIBRARY BIN(Library Seat Map)</h1>

  <p class="text-center mb-4 font-semibold text-gray-700">
    When you enter the library, mark your seat. When you leave, unmark it so someone else can use it.
    <br>
    ЁЯУв <strong>рдкреБрд╕реНрддрдХрд╛рд▓рдп рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдкрд░ рд╕реАрдЯ рдХреЛ рдЪрд┐рдиреНрд╣рд┐рдд рдХрд░реЗрдВ рдФрд░ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░ рдЙрд╕реЗ рдЦрд╛рд▓реА рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЕрдиреНрдп рд▓реЛрдЧ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдВред</strong>
  </p>

  <div id="seats" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 max-w-6xl mx-auto">
    {% for seat in seats %}
      <div class="p-4 rounded-lg shadow text-center cursor-pointer seat-box 
                  {% if seat.status == 'available' %}bg-green-200{% else %}bg-red-300{% endif %}" 
           data-id="{{ seat.id }}" data-status="{{ seat.status }}">
        <p class="text-lg font-semibold">Seat {{ seat.id }}</p>
        <p class="mt-2 text-md font-bold 
                  {% if seat.status == 'available' %}text-green-700{% else %}text-red-700{% endif %}">
          {% if seat.status == 'available' %}Seat Available{% else %}Seat Not Available{% endif %}
        </p>
      </div>
    {% endfor %}
  </div>

  <form action="/reset" method="POST" class="max-w-md mx-auto mt-6 p-4 bg-white rounded shadow">
    <label for="password" class="block mb-2 font-semibold">ЁЯФТ Admin Password to Reset:</label>
    <input type="password" name="password" required class="w-full p-2 border rounded mb-3">
    <button type="submit" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700">Reset All Seats</button>
  </form>

  <script>
    document.querySelectorAll(".seat-box").forEach(box => {
      box.addEventListener("click", async () => {
        const seatId = box.dataset.id;
        const currentStatus = box.dataset.status;
        const endpoint = currentStatus === "available" ? `/checkin/${seatId}` : `/free/${seatId}`;
        const res = await fetch(endpoint, { method: "POST" });

        if (res.ok) {
          const newStatus = currentStatus === "available" ? "occupied" : "available";
          box.dataset.status = newStatus;

          // Update styles
          box.classList.toggle("bg-green-200");
          box.classList.toggle("bg-red-300");

          const statusText = box.querySelector("p:nth-child(2)");
          statusText.textContent = newStatus === "available" ? "Seat Available" : "Seat Not Available";
          statusText.classList.toggle("text-green-700");
          statusText.classList.toggle("text-red-700");
        }
      });
    });
  </script>
</body>
</html>
