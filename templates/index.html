<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Library Seat Map</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-2xl font-bold mb-2 text-center">ЁЯУЪ APNI LIBRARAY BIN (Library Seat Map)</h1>

  <p class="text-center mb-4 font-semibold text-gray-700 leading-relaxed px-2">
    ЁЯЩП <strong>Dear Visitor,</strong> please help us make the best use of library space. When you enter the library, tap your seat to mark it. When you're done and leaving, tap again to unmark it.
    <br>
    This simple action ensures others can find a free seat and make the most of their learning time. Thank you for your cooperation! ЁЯЩМ
    <br><br>
    ЁЯУв <strong>рдкреНрд░рд┐рдп рдЖрдЧрдВрддреБрдХ,</strong> рдХреГрдкрдпрд╛ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреА рд╕реАрдЯреЛрдВ рдХрд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдЙрдкрдпреЛрдЧ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВред рдЬрдм рдЖрдк рдкреБрд╕реНрддрдХрд╛рд▓рдп рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░реЗрдВ рддреЛ рдЕрдкрдиреА рд╕реАрдЯ рдХреЛ рдЯреИрдк рдХрд░рдХреЗ рдЪрд┐рдиреНрд╣рд┐рдд рдХрд░реЗрдВред рдЬрдм рдЖрдк рдкреБрд╕реНрддрдХрд╛рд▓рдп рдЫреЛрдбрд╝реЗрдВ рддреЛ рд╕реАрдЯ рдХреЛ рдЯреИрдк рдХрд░рдХреЗ рдЦрд╛рд▓реА рдХрд░реЗрдВред
    <br>
    рдпрд╣ рдЫреЛрдЯреА рд╕реА рдХреНрд░рд┐рдпрд╛ рджреВрд╕рд░реЛрдВ рдХреЛ рд╕реАрдЦрдиреЗ рдХрд╛ рдмреЗрд╣рддрд░ рдЕрд╡рд╕рд░ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред рдЖрдкрдХреЗ рд╕рд╣рдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж! ЁЯТб
  </p>

  <!-- ЁЯФ▓ Seat Grid -->
  <div id="seats" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 max-w-6xl mx-auto">
    {% for seat in seats %}
      <div class="p-4 rounded-lg shadow text-center cursor-pointer seat-box 
                  {% if seat.status == 'available' %}bg-green-200{% else %}bg-red-300{% endif %}" 
           data-id="{{ seat.id }}" data-status="{{ seat.status }}">
        <p class="text-lg font-semibold">Seat {{ seat.id }}</p>
        <p class="mt-2 text-md font-bold 
                  {% if seat.status == 'available' %}text-green-700{% else %}text-red-700{% endif %}">
          {% if seat.status == 'available' %}Seat Available{% else %}Seat Not Available{% endif %}
        </p>
      </div>
    {% endfor %}
  </div>

  <!-- ЁЯФР Admin Reset Form -->
  <form action="/reset" method="POST" 
        class="max-w-md mx-auto mt-6 p-4 bg-white rounded shadow"
        onsubmit="return confirm('Are you sure you want to reset all seats?');">
    <label for="password" class="block mb-2 font-semibold">ЁЯФТ Admin Password to Reset:</label>
    <input type="password" name="password" required placeholder="Enter admin password"
           class="w-full p-2 border border-gray-300 rounded mb-3 focus:outline-none focus:ring focus:border-blue-500">
    <button type="submit" 
            class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition">
      Reset All Seats
    </button>
  </form>

  <!-- тЬЕ Seat Interaction Script -->
  <script>
    document.querySelectorAll(".seat-box").forEach(box => {
      box.addEventListener("click", async () => {
        const seatId = box.dataset.id;
        const currentStatus = box.dataset.status;
        const endpoint = currentStatus === "available" ? `/checkin/${seatId}` : `/free/${seatId}`;
        const res = await fetch(endpoint, { method: "POST" });

        if (res.ok) {
          const newStatus = currentStatus === "available" ? "occupied" : "available";
          box.dataset.status = newStatus;

          // Update styles
          box.classList.toggle("bg-green-200");
          box.classList.toggle("bg-red-300");

          const statusText = box.querySelector("p:nth-child(2)");
          statusText.textContent = newStatus === "available" ? "Seat Available" : "Seat Not Available";
          statusText.classList.toggle("text-green-700");
          statusText.classList.toggle("text-red-700");
        }
      });
    });
  </script>
</body>
</html>
